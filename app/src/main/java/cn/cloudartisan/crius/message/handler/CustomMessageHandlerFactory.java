/**
  * Generated by smali2java 1.0.0.558
  * Copyright (C) 2013 Hensence.com
  */

package cn.cloudartisan.crius.message.handler;

import android.content.Context;
import cn.cloudartisan.crius.client.model.Message;
import cn.cloudartisan.crius.util.MessageUtil;

import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;
import java.util.Properties;

public class CustomMessageHandlerFactory {
    static CustomMessageHandlerFactory factory;
    HashMap<String, CustomMessageHandler> parsers = new HashMap();
    Properties properties = new Properties();
    
    private CustomMessageHandlerFactory() {
        InputStream in = CustomMessageHandlerFactory.class.getResourceAsStream("handler.properties");
        try {
            properties.load(in);
            return;
        } catch(IOException e) {
            e.printStackTrace();
        }
    }
    
    public static CustomMessageHandlerFactory getFactory() {
        if(factory == null) {
            factory = new CustomMessageHandlerFactory();
        }
        return factory;
    }
    
    public boolean handle(Context context, Message message) {
        CustomMessageHandler handler = getMessageHandler(message.getType());
        if(handler == null) {
            return true;
        }
        return handler.handle(context, MessageUtil.transform(message));
    }
    
    public CustomMessageHandler getMessageHandler(String msgType) {

        if(parsers.get(msgType) == null) {
            try {
                parsers.put(msgType, (CustomMessageHandler)Class.forName(properties.getProperty(msgType)).newInstance());
            } catch(Exception localException1) {
                localException1.printStackTrace();
            }
        }
        return parsers.get(msgType);
    }
}
