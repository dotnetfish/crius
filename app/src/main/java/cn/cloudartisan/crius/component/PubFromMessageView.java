/**
  * Generated by smali2java 1.0.0.558
  * Copyright (C) 2013 Hensence.com
  */

package cn.cloudartisan.crius.component;

import android.content.Context;
import android.util.AttributeSet;
import android.view.View;
import android.widget.RelativeLayout;
import cn.cloudartisan.crius.R;
import cn.cloudartisan.crius.bean.Message;
import cn.cloudartisan.crius.bean.MessageItemSource;
import cn.cloudartisan.crius.bean.User;
import cn.cloudartisan.crius.db.MessageDBManager;
import cn.cloudartisan.crius.widget.OptionsDialog;

public abstract class PubFromMessageView extends RelativeLayout implements OptionsDialog.OnOperationListener, View.OnLongClickListener {
    ChatListView.OnMessageDeleteListenter OnMessageDeleteListenter;
    public Context _context;
    public Message message;
    OptionsDialog optionsDialog;
    MessageItemSource others;
    User self;
    
    protected abstract void displayMessage();
    
    
    public PubFromMessageView(Context paramContext, AttributeSet paramAttributeSet) {
        super(paramContext, paramAttributeSet);
        _context = paramContext;
    }
    
    public void onFinishInflate() {
        super.onFinishInflate();
        optionsDialog = new OptionsDialog(_context);
        optionsDialog.setOperationListener(this);
    }
    
    public final void displayMessage(Message message, User self, MessageItemSource others) {
        this.self = self;
        this.message = message;
        this.others = others;
        setTag(message);
        if("0".equals(message.status)) {
            MessageDBManager.getManager().updateStatus(message.gid, "1");
        }
        displayMessage();
    }
    
    public void onItemClick(View v) {
        optionsDialog.dismiss();
        if(v.getId() == R.id.delete) {
            OnMessageDeleteListenter.onDelete(message);
        }
    }
    
    public void setOnMessageDeleteListenter(ChatListView.OnMessageDeleteListenter onMessageDeleteListenter) {
        OnMessageDeleteListenter = onMessageDeleteListenter;
    }
    
    public boolean onLongClick(View arg0) {
        optionsDialog.show();
        if((message.fileType != null) && (!message.fileType.equals("0"))) {
            optionsDialog.hide(R.id.copy);
        }
        return false;
    }
}
