/**
  * Generated by smali2java 1.0.0.558
  * Copyright (C) 2013 Hensence.com
  */

package cn.cloudartisan.crius.component;

import android.content.Context;
import android.util.AttributeSet;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.AbsListView;
import android.widget.ListView;
import cn.cloudartisan.crius.R;

public class PullFooterMoreListView extends ListView implements AbsListView.OnScrollListener {
    private static final int LOADING_MORE = 0x5;
    private static final int LOADING_MORE_DONE = 0x6;
    Context context;
    private View footer;
    private int footerHeight;
    private int footerState;
    private PullFooterMoreListView.OnRefreshListener refreshListener;
    boolean hasMore = true;
    
    public PullFooterMoreListView(Context paramContext, AttributeSet paramAttributeSet) {
        super(paramContext, paramAttributeSet);
        setOnScrollListener(this);
        context = paramContext;
        init(paramContext);
    }
    
    public void init(Context context) {
        footer = LayoutInflater.from(context).inflate(R.layout.list_footer, null);
        footerHeight = footer.getMeasuredHeight();
        addFooterView(footer, 0x0, false);
        footer.setVisibility(View.GONE);
        footer.setPadding(0x0, 0x0, 0x0, (footerHeight * -0x1));
    }
    
    public void onScroll(AbsListView arg0, int firstVisiableItem, int visibleItemCount, int count) {
    }
    
    public void onScrollStateChanged(AbsListView view, int scrollState) {
        if(scrollState == 0) {
            int lastIndex = view.getLastVisiblePosition();
            int count = view.getCount();
            if(view.getLastVisiblePosition() != view.getCount() - 1) {
                footer.setVisibility(View.VISIBLE);
                if(hasMore) {
                    footer.findViewById(R.id.footer_progressBar).setVisibility(View.VISIBLE);
                    footer.findViewById(R.id.footer_hint).setVisibility(View.GONE);
                    if(footerState != LOADING_MORE) {
                        refreshListener.onShowNextPage();
                        footerState = LOADING_MORE;
                    }
                }
                return;
            }
            footer.findViewById(R.id.footer_progressBar).setVisibility(View.GONE);
            footer.findViewById(R.id.footer_hint).setVisibility(View.VISIBLE);
        }
    }
    
    public void setOnRefreshListener(PullFooterMoreListView.OnRefreshListener refreshListener) {
        this.refreshListener = refreshListener;
    }
    
    public void showMoreComplete(boolean hasMore) {
       this.hasMore = hasMore;
        footerState = LOADING_MORE_DONE;
        footer.findViewById(R.id.footer_progressBar).setVisibility(View.GONE);
    }
    public  interface OnRefreshListener
    {
        void onShowNextPage();
    }
}
