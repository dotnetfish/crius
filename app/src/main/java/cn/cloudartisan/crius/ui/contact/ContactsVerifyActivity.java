/**
  * Generated by smali2java 1.0.0.558
  * Copyright (C) 2013 Hensence.com
  */

package cn.cloudartisan.crius.ui.contact;

import android.content.Intent;
import android.view.View;
import cn.cloudartisan.crius.R;
import cn.cloudartisan.crius.adapter.ContactsVerifyListViewAdapter;
import cn.cloudartisan.crius.component.PullFooterMoreListView;
import cn.cloudartisan.crius.db.MessageDBManager;
import cn.cloudartisan.crius.ui.base.CIMMonitorActivity;
import cn.cloudartisan.crius.util.MessageUtil;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class ContactsVerifyActivity extends CIMMonitorActivity implements PullFooterMoreListView.OnRefreshListener {
    protected ContactsVerifyListViewAdapter adapter;
    int currentPage;
    private ArrayList<cn.cloudartisan.crius.bean.Message> list;
    protected PullFooterMoreListView messageListView;
    
    public void initComponents() {
        setDisplayHomeAsUpEnabled(true);
        messageListView = (PullFooterMoreListView)findViewById(R.id.messageListView);
        MessageDBManager.getManager().readExpectSystemMessage(ContactFragment.types);
        adapter = new ContactsVerifyListViewAdapter(this, list);
        messageListView.setAdapter(adapter);
        messageListView.setOnRefreshListener(this);
        loadMessageRecord();
    }
    
    public void onResume() {
        super.onResume();
        loadMessageRecord();
    }
    
    public void loadMessageRecord() {
        List localList = MessageDBManager.getManager().queryExpectSystemMessageList(ContactFragment.types, this.currentPage);
        PullFooterMoreListView localPullFooterMoreListView = this.messageListView;
        if ((localList == null) || (localList.isEmpty()) || (localList.size() % 10 != 0)) {}
        for (boolean bool = false;; bool = true)
        {
            localPullFooterMoreListView.showMoreComplete(bool);
            if ((localList != null) && (!localList.isEmpty()))
            {
                this.list.clear();
                this.list.addAll(localList);
                this.adapter.notifyDataSetChanged();
            }
            return;
        }
    }
    
    public int getConentLayout() {
        return R.layout.activity_system_message;
    }
    
    public int getActionBarTitle() {
        return R.string.title_contacts_verify_message;
    }
    
    public void onClick(View arg0) {
    }
    
    public void onHandleButtonClick(cn.cloudartisan.crius.bean.Message message) {
        Intent intent = new Intent(this, RequestHandleActivity.class);
        intent.putExtra("message", message);
        startActivity(intent);
    }
    
    public void onShowNextPage() {
        currentPage = (currentPage + 0x1);
        loadMessageRecord();
    }
    
    public void onMessageReceived(cn.cloudartisan.crius.client.model.Message message) {
        cn.cloudartisan.crius.bean.Message msg = MessageUtil.transform(message);
        if(Arrays.asList(ContactFragment.types).contains(msg.type)) {
            list.add(0x0, msg);
            adapter.notifyDataSetChanged();
        }
    }
}
