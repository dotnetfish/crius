/**
  * Generated by smali2java 1.0.0.558
  * Copyright (C) 2013 Hensence.com
  */

package cn.cloudartisan.crius.ui.chat;

import android.os.Bundle;
import android.view.View;
import cn.cloudartisan.crius.R;
import cn.cloudartisan.crius.bean.MessageItemSource;
import cn.cloudartisan.crius.db.GroupDBManager;
import cn.cloudartisan.crius.db.MessageDBManager;
import cn.cloudartisan.crius.util.MessageUtil;

public class GroupChatActivity extends FriendChatActivity implements View.OnClickListener {
    
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        messageType = "1";
    }
    
    public String[] getIncludedMsgTypes() {
        String[] types = {"1",
        "3"};
        return types;
    }
    
    public void onMessageReceived(cn.cloudartisan.crius.client.model.Message message) {
        cn.cloudartisan.crius.bean.Message msg = MessageUtil.transform(message);
        if(("3".equals(msg.type)) && (msg.sender.equals(messageSource.getId()))) {
            lastMessage = MessageDBManager.getManager().queryMessageById(msg.gid);
            messageList.add(msg);
            adapter.notifyDataSetChanged();
            chatListView.setSelection(chatListView.getBottom());
            MessageDBManager.getManager().updateStatus(msg.gid, "1");
        }
    }
    
    public MessageItemSource getMessageSource() {
        String groupId = getIntent().getStringExtra("othersId");
        return GroupDBManager.getManager().queryGroup(groupId);
    }
    
    public int getMenuIcon() {
        return R.drawable.actionbar_facefriend_icon;
    }
}
